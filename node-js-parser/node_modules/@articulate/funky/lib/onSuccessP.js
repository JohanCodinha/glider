var curry     = require('ramda/src/curry')
var lensIndex = require('ramda/src/lensIndex')
var nth       = require('ramda/src/nth')
var pair      = require('ramda/src/pair')
var pipeP     = require('ramda/src/pipeP')

var combineWithP = require('./combineWithP')
var overP = require('./overP')

// onSuccessP :: (a -> Promise e b) -> (a -> c) -> Promise b
var onSuccessP = function (afterThisP, that, data) { return pipeP(
  combineWithP(pair, afterThisP),
  overP(lensIndex(0), that),
  nth(1)
)(data); }

module.exports = curry(onSuccessP)
